---
title: 科学的上网
date: 2024-03-12 16:10
categories: [科学上网]
tags: [xray,sing-box]
pin: true
---

> 本文可能比较长，目前还没写完，后续会**一直更新**，此文可基本帮助您敲开科学上网的**入门砖**，我是绵阿羊。
{: .prompt-info }

本文所涉及的内容皆为我自己的个人见解，可能会存在一些小错误，大家可以指正。此文面向对象为刚入门的小白，帮助大家更好的了解**“科学上网”**，所以并不会涉及繁琐复杂的内容。

# 一、原理

十年前，可能大家都喜欢打开某某VPN，某某加速器，然后点一下按钮，接下来就通往未知的世界了。经过了十几年的演变，从修改本地hosts到ss横空出世再到后来的*ray，sing-box，hysteria百花齐放。很多方式可能都已经过时了，甚至ss此类纯随机数协议已经可被精准识别封杀了。

可能你手中正好开着小火箭或者其他软件，那你是否会好奇过，这些软件这些协议的工作原理是什么？那么接下来我简单说一下。

## 1.1 封锁原理
在讲解封锁原理之前，简单科普一下我们访问网站的一个过程。建议大家可以看看[此文章](https://www.cnblogs.com/51benpao/p/12984951.html)，简单明了的解释了请求一个网站的过程，当然我这里给大家画一个更**简洁的图。**

如下图所示：

![image-20240314184208911](/assets/img/blog/image-20240314184208911.png)

1. **DNS查询**：首先我们在浏览器中输入www.google.com,浏览器就会开始**查询此域名的ip**地址（查询一般从浏览器缓存到hosts到本地dns缓存到运营商的dns服务器）。
2. **和服务器建立通信**：在获取到ip地址之后，**我们的电脑就会和ip服务器通讯**，比如我方发送一个请求（这个请求数据包会从我们的电脑发送到路由器再发送到下一级路由，再到全国各地的骨干路由，最后到我们的出口路由再到美国的谷歌服务器），**服务器返回给我们一个网页的html**数据并且展示到我们的浏览器中。

上述两步骤中，我们的GFW可以用不同手段进行封锁，比如说，在第一步骤中进行**DNS污染**或者直接在第二步中的最后出口网关或者骨干路由中**封锁对应ip**都可以实现阻挠我们访问国外网站。如下图所示：



**例子：DNS污染**

![image-20240314231626586](/assets/img/blog/image-20240314231626586.png)



**例子：在国际网络出口直接封禁知名网站的ip**



![image-20240314231421131](/assets/img/blog/image-20240314231421131.png)

**GFW**现在实行的就是**黑名单制度**，将各大**外网网站的ip**列入黑名单封禁，让我们无法在国内访问。这也正是所庆幸的，至少不是白名单制度，否则现有的翻墙手段都会失效。而GFW封禁ip的方式，我们后面再细说。



## 1.2 科学上网原理

看完了封锁原理，我们该如何突破封锁呢，也就是进入我们的主题。

由于我们要访问的谷歌域名和他的ip都已经被GFW封锁了，我们无法直接去访问谷歌，那如果我们一定要用谷歌搜索三上悠亚小姐姐的写真呢？聪明的小伙伴可能想到了，就是用微信通知**美国的朋友**让他去谷歌搜索写真集，然后再把写真通过微信发给我们。好的，那么我们就已经解决了GFW的封锁。具体原理就是将微信换成vpn或者其他客户端工具，美国的朋友换成国外没被墙的服务器即可。

原理如下图所示：

![image-20240314232331594](/assets/img/blog/image-20240314232331594.png)

如上图所示的曲线救国方式，**本地**通过和国外**没被墙的服务器**通讯，再让国外**没被墙的服务器**访问**被墙网站**，将获取到的数据**返回给本地**即可，就可以实现科学上网了。**（socks5方式翻墙）**

但是存在一个问题，我们在和国外**没被墙的服务器**通信时，如何确保内容不被监听的，那也很简单，我们只需要将想要请求的数据**在本地进行一次加密**，然后发送到国外**没被墙的服务器**进行**解密**，然后再让国外**没被墙的服务器**访问**被墙网站**，将获取到的内容数据再次**加密**，发送到我们的**本地**，本地再**解密**即可，如下图所示。目前所有的科学上网原理都是如此，大同小异，只不过**加密和伪装的方式不同**。

![image-20240314233124977](/assets/img/blog/image-20240314233124977.png)

### 1.3 现如今的封锁策略

我们上图知道了翻墙的大概原理，那么理论上通过曲线救国的方式就万无一失了吗？但是现实情况是，GFW发现了这种曲线救国的方案，并作出了一些针对性措施。

就从最早的**shadowsocks**，或者**vpn**类的加密方式说起，都是使用某种特定的加密算法将**数据流量**加密成一串**随机字符串**，虽然说**GFW**无法破解这些流量（现实情况也确实无法破解加密的流量），但是这类没有伪装的加密流量存在一个致命弱点，就是**加密后的随机字符串和正常的http流量存在巨大的差异**。有兴趣的同学可以看一下这篇文章[shadowsocks是如何被识别的？](https://gfw.report/talks/imc20/zh/)。

> 在Shadowsocks中， 客户端与服务端之间的连接是加密的。 而且这种加密后， 观察者看到的全部都是密文。 这一点与TLS不同。 TLS的报头中含有明文。 而Shadowsocks流量则全部是密文。 如果你观察就会发现Shadowsocks的流量 就好像一列列均匀随机的字节。 而其就是这么设计的。 这样的设计意味着，你不能仅仅用一个 简单的正则表达来匹配出所有的Shadowsocks流量。 你得更努力一些才行。



当GFW通过各种手段识别出这类不正常的流量，就会对其进行相关处理（比如说**封禁你的vps ip**），确实，2019年5月之后，ss已经处于基本不能使用的状态了。

针对GFW的识别，各类大神又采取了不同的针对措施，百花齐放，比如前年很火的**vmess+ws+tls**，通过在随机加密的流量外层套上一层**tls加密**，将其**伪装成https流量来欺骗GFW**。但是GFW也在一直升级。

2022年10月，大量的**vmess+ws+tls** 节点被封禁端口，我那个时候也中招了。有的小伙伴可能会问了，为什么已经**伪装成https流量还是会被封禁**，这里就出现了一个问题。具体可以看这篇文章[(XTLS深入浅出)](https://github.com/XTLS/Xray-core/discussions/1295)。

我这里简单解释一下，由于我们正常访问网站就是一个**https流量**，在使用此类伪装加密协议后，就会导致在**此流量外层又套上一层tls加密**，这必然会导致出现一些特征，比如说**数据包的长度**和**顺序基本固定**以及和正常https**存在少许差异**。

比如说：**tls in tls**加密的明显特征，数据包长度特殊又固定，如果细看就很容易找出规律。也就是文章所说的生死五包问题。

```
第一个包 	很短 	唯一的变数是目标地址 
第二个包 	很短 	几乎固定
第三个包 	短 	变化很少 几乎唯一的变数是目标 SNI
第四个包 	长 	变化较大
第五个包 	很短 	变化很少
```



当然文章也给出了相应的解决办法，就引入现在最流行的**Vision填充**，随机填充数据包长度来减小这类特征。或者是使用**多路复用**，**打乱数据包的时序特征**。到目前为止（**2024-03-15**），这种手段还是十分稳健的。

而现在最主流的翻墙方式，我推荐的就是**Vless+Vision+Reality**了（**Reality**我就不细说了，有兴趣可以去Xray社区里看看，很方便的东西）



# 二、目前主流方式

## 2.1 VPN
## 2.2 机场
## 2.3 自建
## 2.4 免费节点

这里简单来说一下网上免费节点的原理，我相信肯定有很多小伙伴想要知道原理



# 三、安全性？

## 3.1 叔叔/网管 能不能看到？

这个问题**老生常谈**了，如果你问我，那我从两个角度给你们解答：
1. 个人见解以及技术上的可行性：**不能**，**第一**就是我们科学上网的方式，不管是vpn还是现在的各种协议，都用了高强度的加密方式，就拿ss这类对称加密方式来说，想要暴力破解的几率基本为0（当然如果你把密钥乱发泄露，那就当我没说）。**第二**，如果不幸加密被破解了，在加密通道内部还有我们正常访问的**https加密**，破解后也无法知道我们具体在访问的内容，最多只是知道一个域名罢了（当然不排除某个好心人在你手机上电脑上安装一张证书或者某些不怀好意的东西）。所以技术上大家完全放心即可。
2. 如果相信我，就相信我说的第一条。~~**你问我为什么这么自信，有些话不能说太多。**~~



## 3.2 VPN/机场老板能不能看到？

可以看到你**访问的网站名**，以及你**本地的ip地址**，还有你付款记录云云（所以我一直都不怎么推荐机场）

如果**使用他们提供的客户端**，并且自身**没办法排除危险因素**，则甚至被监听解密HTTPS流量，所以我向来推荐大家用**开源客户端或者大牌客户端**（注意下载来源），比如**v2rayn，clash.meta，shadowrocket**



## 3.3 高危行为（社工类）

当然，虽然说从技术上基本不会出现纰漏，但是我们还是会看到很多被喝茶的小哥哥小姐姐，那到底是哪里出问题了呢？

我有做过视频具体讲了这些高危行为，可惜现在我已经把视频删完了，所以在这里简单提一下。
1. **国内国外用户名一致**，如果你喜欢大放阙词，建议不要把自己全网用户名都设置的一样，比较蠢
2. 用自己的**qq号手机号做用户名**，同上
3. 喜欢分享生活，国内一张生活照，**国外一张生活照**，同上
4. 使用一些**钓鱼app**，比如说某王vpn
5. **个人隐私泄露**



# 四、机场的使用

## 4.1 机场选择
## 4.2 客户端推荐

# 五、如何自建？

## 4.2 VPS选择
## 4.3 如何自建（以Vision Reality为例）

接下来我就从0开始教大家自建一颗节点，如果嫌麻烦，移步下一步使用一件脚本。



## 4.4 一键脚本安全吗？


# 六、关于客户端的小知识

## 6.1 什么是分流（规则/全局）？
## 6.2 TUN模式是什么？
## 6.3 订阅链接是什么？怎么自己做一个
## 6.4 fakeip是什么？



# 七、DNS相关
## 7.1 DNS工作原理
## 7.2 DNS泄露？

# 八、其他（未完待续）

