---
title: ssh密钥对生成及配置
date: 2024-03-12 16:10
categories: [建站]
tags: [ssh,vps]
---
## 前言

本文环境为：**Macos**

本文介绍**ssh密钥对**生成，以及连接github和vps

## 检查本地是否存在ssh

打开终端输入

```bash
ls -al ~/.ssh
```

如果出现`ls: /Users/k3e1/.ssh: No such file or directory`，则为**不存在**

如果存在密钥对，则结果显示应该**包括公钥和私钥**，可**直接跳过ssh生成**



## 生成ssh密钥对

打开终端，输入下方命令，**一路回车即可**

```bash
ssh-keygen -t ed25519 -C "your_email@example.com"
```

> `ed25519`为加密算法，性能和安全性优于默认的`rsa`
>
> `your_email@example.com` 为备注内容，可替换为自己的

操作完后会在 `~/.ssh` 目录中生两个密钥文件，`id_ed25519` 为私钥，`id_ed25519.pub` 为公钥。



## 上传至github（可选）

查看公钥

```bash
cat ~/.ssh/id_ed25519.pub
```

**复制**公钥

```bash
pbcopy < ~/.ssh/id_ed25519.pub
```

打开**github**，点击右上角头像，点击 **Settings->SSH and GPG keys->New SSH key**

在**key**中填入刚刚复制的公钥，点击保存

检验是否添加成功

```bash
ssh -T git@github.com
```



## ssh连接vps（可选）

生成的私钥公钥，也可以用作其他作用，比如说连接**vps**等，这种方式比密码登陆更加安全，而且更方便管理多台VPS

### 上传公钥

将刚生成的公钥上传至你的vps中，可以直接使用 `ssh-copy-id`

```bash
ssh-copy-id -i ~/.ssh/id_ed25519.pub User@HostName -p Port
```

> `-i`为指定**公钥**路径，后面的`~/.ssh/id_ed25519.pub`是**公钥**路径。
>
> `User` 为用户名，`HostName` 为 IP 地址，`Port` 为端口号。

`ssh-copy-id`作用就是将**本地**的`~/.ssh/id_ed25519.pub`中的公钥内容放入**vps**中`~/.ssh/authorized_keys`中，并**设置相应的读取权限**



### 连接VPS

接下来连接vps

```bash
ssh User@HostName -p Port
```

> 该操作会默认使用`.ssh`目录下的所有**私钥**进行尝试匹配

如果我的私钥不在ssh目录下，也可指定私钥

```
ssh -i ~/.ssh/k3e1 User@HostName -p Port
```



### 设置多台vps

如果你有多个 VPS 使用不同密钥，那么使用 SSH 配置文件 ( `~/.ssh/config` ) 进行管理是一种优雅且灵活的方式。这相当于在类似 Xshell 这样的图形化 SSH 工具中对每个 SSH 会话连接进行单独设置并保存起来，省去了重复输入复杂参数的过程。

SSH 配置文件默认是不存在的，所以使用**nano**编辑器创建并编辑：

```shell
nano ~/.ssh/config
```

然后参照下面的例子进行填写。

```config
Host K3E1_VPS1
    HostName 233.233.233.233
    Port 2333
    User root
    IdentityFile "~/.ssh/id_ed25519"
    IdentitiesOnly yes

Host K3E1_VPS2
    HostName 66.66.66.66
    Port 6666
    User k3e1
    IdentityFile "~/.ssh/id_rsa"
    IdentitiesOnly yes
```

> `Host` 别名
> `HostName` 主机名，可以用 IP 地址或域名
> `Port` 端口，不填写默认为 22
> `User` 用户名
> `IdentityFile` **私钥**的路径，可指定多个私钥，在连接的过程中会依次尝试。
> `IdentitiesOnly` 只接受 SSH key 登录

编辑好保存并退出，然后设置权限，不然可能无法正常使用。

```shell
chmod 600 ~/.ssh/config
```

当以上操作完成，以后登录 VPS 就只需要在终端内输入 `ssh Host` 就可以登录到 VPS ，就像下面这样：

```shell
ssh K3E1_VPS1
```

### 禁用密码登录

在确认使用密钥能正常登录后，为了提高 VPS 的安全性建议禁用密码登录。

执行以下命令，对 sshd 配置文件 (`/etc/ssh/sshd_config`) 进行修改。

```shell
sudo sed -i '/PasswordAuthentication /c\PasswordAuthentication no' /etc/ssh/sshd_config
```

最后重启 sshd 服务，使配置生效。

```shell
sudo service sshd restart
```
